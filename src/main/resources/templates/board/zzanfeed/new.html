<!DOCTYPE html>
<html lang="en"
      layout:decorate="~{common/layouts/userDefault}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <title>ì§  í”¼ë“œ</title>
    <script src="https://unpkg.com/@yaireo/tagify"></script>
    <script src="https://unpkg.com/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
    <link href="/board/zzanfeed/new.css" rel="stylesheet">
    <link href="https://unpkg.com/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div layout:fragment="content">
    <div class="hero hero-inner">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 mx-auto text-center">
                    <div class="intro-wrap">
                        <h1 class="mb-0">ì§  í”¼ë“œ</h1>
                        <p class="text-white">
                            ì „í†µì£¼ì™€ í•¨ê»˜í•œ íŠ¹ë³„í•œ ìˆœê°„ì„ ì§ í”¼ë“œì— ì—…ë¡œë“œí•˜ì„¸ìš”.<br/>
                            ì§€ê¸ˆ ë‹¹ì‹ ì˜ ì „í†µì£¼ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input accept="image/*" id="thumbnail" name="thumbnail" type="file">
    <div class="cover-upload-container" id="coverPreview">
        ì»¤ë²„ ì‚¬ì§„ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.
        <div class="upload-button-container">
            <button class="upload-button" id="uploadButton">
                ì»¤ë²„ì‚¬ì§„ ì¶”ê°€í•˜ê¸°
            </button>
        </div>
    </div>

    <div class="title-container">
        <div class="input-group">
            <label for="postTitle"></label>
            <input class="form-control" id="postTitle" placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." type="text">
        </div>
    </div>

    <div class="hashtag-container">
        <input class='some_class_name' name='tags' placeholder='í•´ì‹œíƒœê·¸ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.'>
    </div>

    <div class="editor-wrapper">
        <div class="square-box">
            <div class="upload-content">
                <div class="camera-icon">ğŸ“·</div>
                <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                <p>10ì¥ê¹Œì§€ ì˜¬ë¦´ ìˆ˜ ìˆì–´ìš”</p>
                <input class="file-input" multiple style="display: none;" type="file"/>
                <button class="upload-button" onclick="uploadImage(this)">PCì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
        <div class="editor-container">
            <div class="summernote"></div>
        </div>
    </div>

    <div class="add-wrapper">
        <div class="square-box add-box" onclick="addEditorWrapper()">
            <div class="add-content">+</div>
        </div>
    </div>

    <div class="submit-wrapper">
        <button class="submit-button" onclick="submitContent()">ë“±ë¡í•˜ê¸°</button>
    </div>

    <script th:inline="javascript">
        $('#uploadButton').click(function () {
            $('#thumbnail').click();
        });

        $('#thumbnail').change(function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    $('#coverPreview').css({
                        'background-image': `url(${e.target.result})`,
                        'background-size': 'cover',
                        'background-position': 'center',
                        'color': 'transparent'
                    });
                }
                reader.readAsDataURL(file);
            }
        });

        let input = document.querySelector('input[name="tags"]');

        let whitelist = [
            "#ë§‰ê±¸ë¦¬", "#ì†Œì£¼", "#ì²­ì£¼", "#ì™€ì¸", "#ì „í†µì£¼", "#ì£¼ë§‰", "#ìˆ ì§‘", "#ì „í†µì£¼ì¶”ì²œ",
            "#ì „í†µì£¼ë§›ì§‘", "#ë§‰ê±¸ë¦¬ë§›ì§‘", "#ì†Œì£¼ë§›ì§‘", "#ì²­ì£¼ë§›ì§‘", "#í•œì”í•©ì‹œë‹¤", "#ìˆ ìë¦¬",
            "#ìˆ ì•ˆì£¼", "#ìˆ í•œì”", "#ì „í†µì£¼ìŠ¤íƒ€ê·¸ë¨", "#ìˆ ì´ì•¼ê¸°", "#ì „í†µì£¼ì‚¬ë‘", "#ë§‰ê±¸ë¦¬ì‚¬ë‘",
            "#ì†Œì£¼ì‚¬ë‘", "#ì²­ì£¼ì‚¬ë‘", "#í•œì”ì˜ì—¬ìœ ", "#ìˆ ê³¼í•¨ê»˜", "#ì „í†µì£¼ì—¬í–‰", "#ì „í†µì£¼ë¬¸í™”",
            "#ì „í†µì£¼ì¶•ì œ", "#ì „í†µì£¼í•œì”", "#ì „í†µì£¼ì—­ì‚¬", "#ë§‰ê±¸ë¦¬í•œì”", "#ì†Œì£¼í•œì”", "#ì²­ì£¼í•œì”",
            "#ìˆ ê³¼ì „í†µ", "#ì „í†µì£¼ê¸°í–‰", "#ìˆ í•œì”ì–´ë•Œ", "#í•œì”ì˜í–‰ë³µ", "#ì „í†µì£¼ì •ëª¨", "#ì „í†µì£¼ì¼ê¸°",
            "#ìˆ ì‚¬ë‘", "#ë§‰ê±¸ë¦¬ì¼ê¸°", "#ì†Œì£¼ì¼ê¸°", "#ì²­ì£¼ì¼ê¸°", "#ì „í†µì£¼í•œìƒ", "#ìˆ ê³¼ë¬¸í™”",
            "#ìˆ ê³¼ì´ì•¼ê¸°", "#ìˆ ì´ì•¼ê¸°ë‚˜ëˆ„ê¸°", "#ì „í†µì£¼ì¶”ì²œë§›ì§‘", "#ë§‰ê±¸ë¦¬ì¶”ì²œë§›ì§‘", "#ì†Œì£¼ì¶”ì²œë§›ì§‘",
            "#ì²­ì£¼ì¶”ì²œë§›ì§‘", "#ìˆ ê³¼ì˜ì‹œê°„", "#ì „í†µì£¼ì´ì•¼ê¸°", "#ì „í†µì£¼ì™€í•¨ê»˜", "#ë§‰ê±¸ë¦¬ì™€í•¨ê»˜",
            "#ì†Œì£¼ì™€í•¨ê»˜", "#ì²­ì£¼ì™€í•¨ê»˜", "#ìˆ ìë¦¬ê°€ì¢‹ì€ê³³", "#ì „í†µì£¼ê´€ê´‘", "#ì „í†µì£¼ì²´í—˜",
            "#ìˆ ê³¼ì „í†µë¬¸í™”", "#ìˆ ë¡œì—¬í–‰", "#ì „í†µì£¼ì—¬í–‰ê¸°", "#ìˆ ê³¼ëª…ì†Œ", "#ì „í†µì£¼ëª…ì†Œ", "#ë§‰ê±¸ë¦¬ëª…ì†Œ",
            "#ì†Œì£¼ëª…ì†Œ", "#ì²­ì£¼ëª…ì†Œ", "#ì „í†µì£¼ë§›ì§‘íƒë°©", "#ìˆ ìë¦¬ì¶”ì²œ", "#ìˆ ìë¦¬íŒ"
        ];

        let tagify = new Tagify(input, {
            whitelist: whitelist,
            maxTags: 10,
            dropdown: {
                maxItems: 20,
                classname: "tags-look",
                enabled: 0,
                closeOnSelect: false
            }
        })

        $(document).ready(function () {
            $('#summernote').summernote({
                height: 180,
                disableResizeEditor: true
            });
        });

        $(document).ready(function () {
            $('.summernote').summernote({
                lang: 'ko-KR',
                height: 180,
                disableResizeEditor: true
            });
        });

        function addEditorWrapper() {
            // ìƒˆ editor-wrapper HTML
            const newWrapper = `
        <div class="editor-wrapper">
            <div class="square-box">
                <div class="upload-content">
                    <div class="camera-icon">ğŸ“·</div>
                    <p>ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                    <p>10ì¥ê¹Œì§€ ì˜¬ë¦´ ìˆ˜ ìˆì–´ìš”</p>
                    <input class="file-input" multiple style="display: none;" type="file"/>
                    <button class="upload-button" onclick="uploadImage(this)">PCì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                </div>
            </div>
            <div class="editor-container">
                <div class="summernote"></div>
            </div>
        </div>
    `;

            // ê¸°ì¡´ì˜ add-box ìœ„ì— ìƒˆë¡œìš´ editor-wrapper ì¶”ê°€
            $(newWrapper).insertBefore('.add-wrapper');

            // ìƒˆë¡œ ì¶”ê°€ëœ summernoteë¥¼ ì´ˆê¸°í™”
            $('.summernote').last().summernote({
                height: 180,
                disableResizeEditor: true
            });
        }

        function uploadImage(button) {
            const fileInput = $(button).siblings('.file-input');
            fileInput.click();

            fileInput.on('change', function (event) {
                const files = event.target.files;

                if (files.length > 0) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const imagePreview = `
                        <img src="${e.target.result}" alt="ë¯¸ë¦¬ë³´ê¸°" style="width: 100%; height: auto; border-radius: 5px;">
                    `;
                        // ê¸°ì¡´ì˜ .upload-content ë‚´ìš©ì„ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ë¡œ ëŒ€ì²´
                        $(button).parent().html(imagePreview);
                    };

                    reader.readAsDataURL(files[0]); // ì²« ë²ˆì§¸ íŒŒì¼ë§Œ ì²˜ë¦¬
                }
            });
        }

        function submitContent() {
            const imageList = [];
            const textList = [];

            // ê° editor-wrapperì—ì„œ ì´ë¯¸ì§€ë¥¼ ìˆ˜ì§‘
            $('.editor-wrapper').each(function () {
                const imageElement = $(this).find('img');
                const textContent = $(this).find('.summernote').summernote('code');

                console.log(textContent);

                if (imageElement.length > 0) {
                    imageList.push(imageElement.attr('src'));
                }

                textList.push(textContent);
            });

            // ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ë¶€ë¶„ (ì˜ˆ: Ajax ì‚¬ìš©)
            const postData = {
                images: imageList,
                texts: textList
            };

            // console.log('ì „ì†¡í•  ë°ì´í„°:', postData);

            // ì˜ˆì‹œë¡œ POST ìš”ì²­
            $.ajax({
                url: '/your-server-endpoint',  // ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë³€ê²½
                method: 'POST',
                data: JSON.stringify(postData),
                contentType: 'application/json',
                success: function (response) {
                    alert('ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                },
                error: function (error) {
                    alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }
    </script>
</div>
</body>
</html>